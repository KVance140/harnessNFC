<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>NFC Harness Inventory</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 16px;
    font-size: 18px;
  }

  button, select, input {
    font-size: 20px;
    padding: 14px;
    margin: 8px 0;
    width: 100%;
  }

  #status {
    font-weight: bold;
    padding: 14px;
    margin-bottom: 12px;
    text-align: center;
    border-radius: 8px;
  }

  .ready { background: #e6f4ea; color: #1e7e34; }
  .scanning { background: #e7f1ff; color: #0d6efd; }
  .stopped { background: #fdecea; color: #b02a37; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
  }

  #editForm {
    margin-top: 16px;
  }
</style>
</head>

<body>

<h3>NFC Harness Inventory - T3803</h3>

<div id="status" class="ready">Ready to Scan</div>

<select id="mode">
  <option value="continue">Scan & Continue</option>
  <option value="edit">Scan & Edit</option>
</select>

<button onclick="startScan()">Start Scanning</button>
<button onclick="stopScan()">Stop Scanning</button>
<button onclick="exportCSV()">Export CSV</button>

<table>
  <thead>
    <tr>
      <th>Serial</th>
      <th>Location</th>
      <th>Size</th>
      <th>Shift</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<div id="editForm" style="display:none;">
  <h4>Edit Harness</h4>
  <input id="location" placeholder="Warehouse Location">
  <input list="size" name="size" placeholder="Harness Size">
    <datalist id="size">
      <option value="XXS">XXS</option>
      <option value="XS">XS</option>
      <option value="Universal">Universal</option>
      <option value="Medium">Medium</option>
      <option value="Large">Large</option>
      <option value="XL">XL</option>
      <option value="XXL">XXL</option>
  </datalist>
  <input list="shift" name="shift" placeholder="Shift">
    <select id="shift">
      <option value="A1">A1</option>
      <option value="A2">A2</option>
      <option value="B1">B1</option>
      <option value="B2">B2</option>
      <option value="EF">E&F</option>
      <option value="Other">Other</option>
  </select>
  <button onclick="saveEdit()">Save</button>
</div>

<script>
let reader = null;
let scanning = false;
let records = [];
let currentSerial = null;

function setStatus(text, cssClass) {
  const status = document.getElementById("status");
  status.textContent = text;
  status.className = cssClass;
}

async function startScan() {
  if (scanning) return;

  reader = new NDEFReader();
  await reader.scan();
  scanning = true;
  setStatus("Scanningâ€¦ Tap NFC Tag", "scanning");

  reader.onreading = ({ serialNumber }) => {
    const mode = document.getElementById("mode").value;

    if (mode === "continue") {
      addRecord(serialNumber);
    } else {
      currentSerial = serialNumber;
      document.getElementById("editForm").style.display = "block";
    }
  };
}

function stopScan() {
  reader = null;
  scanning = false;
  setStatus("Scanning Stopped", "stopped");
}

function addRecord(serial, location="", size="", shift="") {
  records.push({
    serial,
    location,
    size,
    shift,
    time: new Date().toISOString()
  });
  renderTable();
}

function saveEdit() {
  addRecord(
    currentSerial,
    location.value,
    size.value,
    shift.value
  );

  location.value = "";
  size.value = "";
  shift.value = "";
  editForm.style.display = "none";
}

function renderTable() {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  records.forEach(r => {
    tbody.innerHTML += `
      <tr>
        <td>${r.serial}</td>
        <td>${r.location}</td>
        <td>${r.size}</td>
        <td>${r.shift}</td>
        <td>${r.time}</td>
      </tr>`;
  });
}

function exportCSV() {
  const header = "Serial,Location,Size,Shift,Timestamp\n";
  const rows = records.map(r =>
    `${r.serial},${r.location},${r.size},${r.shift},${r.time}`
  ).join("\n");

  const blob = new Blob([header + rows], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "harness_inventory.csv";
  a.click();
}
</script>

</body>
</html>
